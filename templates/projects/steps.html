{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: flex-start; gap: 10px; margin-bottom: 10px;">
  <a href="{% url 'project_gallery' project.id %}" class="btn btn-outline-primary">üìÅ Gallery</a>
  <a href="/projects/{{ project.id }}/leed_certificate_analysis" class="btn btn-outline-success">LEED Analysis</a>
  <a href="/projects/{{ project.id }}/well_certificate_analysis" class="btn btn-outline-info">WELL Analysis</a>
</div>
<h2>Project: {{ project.name }}</h2>
<h3>Step {{ step }} of 3</h3>

<div class="steps-container">

  {% if step == 1 %}
    <!-- Step 1: Carbon Tool -->
    <div class="step-box active">
      <h4>Step 1: Carbon Tool</h4>
      {% if project.carbon_insight %}
        {% include "tools/carbon_result.html" with breakdown=project.carbon_data total=project.total_emission insight=project.carbon_insight %}
      {% else %}
        {% include "tools/carbon_tool.html" with formset=carbon_formset %}
      {% endif %}
    </div>

  {% elif step == 2 %}
    <!-- Step 2: Waste Tool -->
    <div class="step-box active">
      <h4>Step 2: Waste Tool</h4>
      {% if project.waste_insight %}
        {% include "tools/waste_result.html" with data=project.waste_data insight=project.waste_insight %}
      {% else %}
        {% include "tools/waste_tool.html" with form=form %}
      {% endif %}
    </div>

  {% elif step == 3 %}
    <!-- Step 3: Design Tool -->
    <div class="step-box active">
      <h4>Step 3: Design Tool</h4>
      {% if project.design_insight %}
        {% include "tools/design_result.html" with data=project.design_data insight=project.design_insight %}
      {% else %}
        {% include "tools/design_tool.html" %}
      {% endif %}
    </div>
  {% endif %}

</div>

<!-- Navigation Buttons -->
<div class="navigation-buttons mt-3" style="display: flex; justify-content: space-between">
  {% if step > 1 %}
    <a href="{% url 'project_step' project_id=project.id step=step|add:'-1' %}" class="btn btn-secondary">‚Üê Previous Step</a>
  {% endif %}
  {% if step < 4 %}
    <a href="{% url 'project_step' project_id=project.id step=step|add:'1' %}" class="btn btn-primary">Next Step ‚Üí</a>
  {% endif %}
</div>

<a href="{% url 'dashboard' %}" class="btn btn-outline-secondary mt-4">‚Üê Back to Dashboard</a>

<style>
  .steps-container {
    max-width: 900px;
    margin: 20px auto;
  }
  .step-box {
    border: 2px solid #ddd;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    background: #f9f9f9;
    opacity: 1;
    pointer-events: auto;
    transition: background-color 0.3s ease;
  }
  .step-box.disabled {
    opacity: 0.5;
    pointer-events: none;
    background: #eee;
  }
  .step-box.active {
    border-color: #007bff;
    background: #e7f1ff;
  }
</style>
{% endblock %}
